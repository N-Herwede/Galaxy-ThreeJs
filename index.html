<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSMOS EXPLORER | 3D Solar System</title>
    
    <!-- Orbitron - Galaxy Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="canvas-container"></div>

    <!-- Header -->
    <header id="header">
        <h1>COSMOS EXPLORER</h1>
        <div class="stats">
            <div class="stat"><span class="label">FPS</span><span id="fps">60</span></div>
            <div class="stat"><span class="label">TIME</span><span id="time">00:00</span></div>
        </div>
    </header>

    <!-- Controls -->
    <div id="controls">
        <button id="btn-play" class="ctrl-btn active" title="Play/Pause (Space)">
            <svg id="icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            <svg id="icon-play" viewBox="0 0 24 24" style="display:none"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <button id="btn-reset" class="ctrl-btn" title="Reset Camera (R)">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
        </button>
        <button id="btn-orbits" class="ctrl-btn active" title="Toggle Orbits (O)">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
        <button id="btn-labels" class="ctrl-btn active" title="Toggle Labels (L)">
            <svg viewBox="0 0 24 24"><path d="M5 4v3h5.5v12h3V7H19V4z"/></svg>
        </button>
        <button id="btn-sound" class="ctrl-btn" title="Toggle Sound (M)">
            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </button>
        <div class="speed-control">
            <span class="speed-label">SPEED</span>
            <input type="range" id="speed" min="0" max="5" step="0.1" value="1">
            <span id="speed-val">1.0x</span>
        </div>
    </div>

    <!-- Planet Info Popup -->
    <div id="planet-popup" class="hidden">
        <div class="popup-header">
            <div class="planet-visual" id="popup-visual"></div>
            <div class="planet-title">
                <h2 id="popup-name">Planet</h2>
                <span id="popup-type">Type</span>
            </div>
            <button id="popup-close">√ó</button>
            <button id="popup-speak" title="Read Aloud">
                <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            </button>
        </div>
        <div class="popup-body">
            <div class="data-grid">
                <div class="data-item">
                    <span class="data-icon">üåç</span>
                    <div class="data-content">
                        <span class="data-label">DIAMETER</span>
                        <span id="popup-diameter" class="data-value">-</span>
                    </div>
                </div>
                <div class="data-item">
                    <span class="data-icon">üìç</span>
                    <div class="data-content">
                        <span class="data-label">DISTANCE FROM SUN</span>
                        <span id="popup-distance" class="data-value">-</span>
                    </div>
                </div>
                <div class="data-item">
                    <span class="data-icon">‚è±Ô∏è</span>
                    <div class="data-content">
                        <span class="data-label">ORBITAL PERIOD</span>
                        <span id="popup-period" class="data-value">-</span>
                    </div>
                </div>
                <div class="data-item">
                    <span class="data-icon">üå°Ô∏è</span>
                    <div class="data-content">
                        <span class="data-label">TEMPERATURE</span>
                        <span id="popup-temp" class="data-value">-</span>
                    </div>
                </div>
                <div class="data-item">
                    <span class="data-icon">üåô</span>
                    <div class="data-content">
                        <span class="data-label">MOONS</span>
                        <span id="popup-moons" class="data-value">-</span>
                    </div>
                </div>
                <div class="data-item">
                    <span class="data-icon">‚öñÔ∏è</span>
                    <div class="data-content">
                        <span class="data-label">GRAVITY</span>
                        <span id="popup-gravity" class="data-value">-</span>
                    </div>
                </div>
            </div>
            <div class="fact-box">
                <h4>DID YOU KNOW?</h4>
                <p id="popup-fact">-</p>
            </div>
            <div class="popup-actions">
                <button id="popup-focus" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06z"/></svg>
                    FOCUS
                </button>
                <button id="popup-follow" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93z"/></svg>
                    FOLLOW
                </button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="hidden"></div>

    <!-- Loading -->
    <div id="loading">
        <div class="loader">
            <div class="sun-loader"></div>
            <div class="orbit-loader"></div>
            <div class="orbit-loader o2"></div>
        </div>
        <h2>COSMOS EXPLORER</h2>
        <p id="load-status">Initializing...</p>
        <div class="load-bar"><div id="load-progress"></div></div>
    </div>

    <!-- Shaders -->
    <script id="sun-vertex" type="x-shader/x-vertex">
        varying vec2 vUv;
        varying vec3 vPosition;
        varying vec3 vNormal;
        
        void main() {
            vUv = uv;
            vPosition = position;
            vNormal = normalize(normalMatrix * normal);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    
    <script id="sun-fragment" type="x-shader/x-fragment">
        uniform float uTime;
        uniform float uIntensity;
        varying vec2 vUv;
        varying vec3 vPosition;
        varying vec3 vNormal;
        
        // Simplex noise functions
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
        
        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            
            vec3 i = floor(v + dot(v, C.yyy));
            vec3 x0 = v - i + dot(i, C.xxx);
            
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min(g.xyz, l.zxy);
            vec3 i2 = max(g.xyz, l.zxy);
            
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            
            i = mod289(i);
            vec4 p = permute(permute(permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0))
                + i.y + vec4(0.0, i1.y, i2.y, 1.0))
                + i.x + vec4(0.0, i1.x, i2.x, 1.0));
            
            float n_ = 0.142857142857;
            vec3 ns = n_ * D.wyz - D.xzx;
            
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_);
            
            vec4 x = x_ *ns.x + ns.yyyy;
            vec4 y = y_ *ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            
            vec4 b0 = vec4(x.xy, y.xy);
            vec4 b1 = vec4(x.zw, y.zw);
            
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
            
            vec3 p0 = vec3(a0.xy, h.x);
            vec3 p1 = vec3(a0.zw, h.y);
            vec3 p2 = vec3(a1.xy, h.z);
            vec3 p3 = vec3(a1.zw, h.w);
            
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
            p0 *= norm.x;
            p1 *= norm.y;
            p2 *= norm.z;
            p3 *= norm.w;
            
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }
        
        float fbm(vec3 p) {
            float value = 0.0;
            float amplitude = 0.5;
            float frequency = 1.0;
            for(int i = 0; i < 6; i++) {
                value += amplitude * snoise(p * frequency);
                amplitude *= 0.5;
                frequency *= 2.0;
            }
            return value;
        }
        
        void main() {
            vec3 pos = vPosition * 2.0;
            float time = uTime * 0.15;
            
            // Multiple layers of flowing noise
            float noise1 = fbm(pos + time * 0.5);
            float noise2 = fbm(pos * 2.0 - time * 0.3);
            float noise3 = fbm(pos * 4.0 + time * 0.2);
            
            float combinedNoise = noise1 * 0.5 + noise2 * 0.3 + noise3 * 0.2;
            
            // Temperature gradient (center hotter)
            float temp = 0.6 + combinedNoise * 0.4;
            
            // Color based on temperature
            vec3 coolColor = vec3(1.0, 0.3, 0.0);   // Dark orange/red
            vec3 midColor = vec3(1.0, 0.6, 0.1);    // Orange
            vec3 hotColor = vec3(1.0, 0.95, 0.7);   // Yellow/white
            
            vec3 color;
            if(temp < 0.5) {
                color = mix(coolColor, midColor, temp * 2.0);
            } else {
                color = mix(midColor, hotColor, (temp - 0.5) * 2.0);
            }
            
            // Sunspots
            float spots = smoothstep(0.4, 0.5, fbm(pos * 3.0 + vec3(0.0, time * 0.1, 0.0)));
            color = mix(color, vec3(0.2, 0.08, 0.0), spots * 0.7);
            
            // Bright granules
            float granules = smoothstep(0.3, 0.7, fbm(pos * 8.0 - time * 0.5));
            color += vec3(0.3, 0.2, 0.1) * granules;
            
            // Limb darkening
            float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 1.5);
            color *= 1.0 - fresnel * 0.4;
            
            // Final intensity
            color *= uIntensity;
            
            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script id="glow-vertex" type="x-shader/x-vertex">
        varying vec3 vNormal;
        varying vec3 vPositionNormal;
        
        void main() {
            vNormal = normalize(normalMatrix * normal);
            vPositionNormal = normalize((modelViewMatrix * vec4(position, 1.0)).xyz);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    
    <script id="glow-fragment" type="x-shader/x-fragment">
        uniform vec3 uColor;
        uniform float uIntensity;
        uniform float uPower;
        varying vec3 vNormal;
        varying vec3 vPositionNormal;
        
        void main() {
            float intensity = pow(uIntensity - dot(vNormal, vPositionNormal), uPower);
            gl_FragColor = vec4(uColor, 1.0) * intensity;
        }
    </script>

    <script id="planet-vertex" type="x-shader/x-vertex">
        varying vec2 vUv;
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec3 vWorldPosition;
        
        void main() {
            vUv = uv;
            vNormal = normalize(normalMatrix * normal);
            vPosition = position;
            vec4 worldPos = modelMatrix * vec4(position, 1.0);
            vWorldPosition = worldPos.xyz;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    
    <script id="planet-fragment" type="x-shader/x-fragment">
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        uniform vec3 uColor3;
        uniform float uTime;
        uniform int uPlanetType;
        uniform vec3 uSunPosition;
        uniform float uAtmosphere;
        varying vec2 vUv;
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec3 vWorldPosition;
        
        // Noise functions
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
        
        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            vec3 i = floor(v + dot(v, C.yyy));
            vec3 x0 = v - i + dot(i, C.xxx);
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min(g.xyz, l.zxy);
            vec3 i2 = max(g.xyz, l.zxy);
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            i = mod289(i);
            vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
            float n_ = 0.142857142857;
            vec3 ns = n_ * D.wyz - D.xzx;
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_);
            vec4 x = x_ *ns.x + ns.yyyy;
            vec4 y = y_ *ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            vec4 b0 = vec4(x.xy, y.xy);
            vec4 b1 = vec4(x.zw, y.zw);
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
            vec3 p0 = vec3(a0.xy, h.x);
            vec3 p1 = vec3(a0.zw, h.y);
            vec3 p2 = vec3(a1.xy, h.z);
            vec3 p3 = vec3(a1.zw, h.w);
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
            p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }
        
        float fbm(vec3 p, int octaves) {
            float value = 0.0;
            float amplitude = 0.5;
            for(int i = 0; i < 6; i++) {
                if(i >= octaves) break;
                value += amplitude * snoise(p);
                p *= 2.0;
                amplitude *= 0.5;
            }
            return value;
        }
        
        void main() {
            vec3 pos = vPosition * 5.0;
            float time = uTime * 0.05;
            
            // Calculate lighting from sun
            vec3 lightDir = normalize(uSunPosition - vWorldPosition);
            float diff = max(dot(vNormal, lightDir), 0.0);
            float ambient = 0.08;
            float light = ambient + diff * 0.92;
            
            vec3 color;
            
            // Different planet types
            if(uPlanetType == 0) {
                // Mercury - cratered gray
                float craters = fbm(pos * 4.0, 5);
                color = mix(uColor1, uColor2, craters * 0.5 + 0.5);
                float crater = smoothstep(0.3, 0.5, fbm(pos * 8.0, 4));
                color = mix(color, uColor1 * 0.6, crater);
            }
            else if(uPlanetType == 1) {
                // Venus - cloudy swirls
                float swirl = fbm(pos + vec3(time * 0.5, 0.0, time * 0.3), 5);
                color = mix(uColor1, uColor2, swirl * 0.5 + 0.5);
                float clouds = fbm(pos * 2.0 - time, 4);
                color = mix(color, uColor3, clouds * 0.3);
            }
            else if(uPlanetType == 2) {
                // Earth - continents and oceans
                float continents = fbm(pos * 2.0, 5);
                float isLand = step(0.1, continents);
                vec3 ocean = uColor1;
                vec3 land = mix(uColor2, uColor3, fbm(pos * 6.0, 3) * 0.5 + 0.5);
                color = mix(ocean, land, isLand);
                // Ice caps
                float latitude = abs(vUv.y - 0.5) * 2.0;
                float ice = smoothstep(0.85, 0.95, latitude);
                color = mix(color, vec3(1.0), ice);
            }
            else if(uPlanetType == 3) {
                // Mars - rusty with dark regions
                float terrain = fbm(pos * 3.0, 5);
                color = mix(uColor1, uColor2, terrain * 0.5 + 0.5);
                float dark = smoothstep(0.2, 0.5, fbm(pos * 2.0, 4));
                color = mix(color, uColor3, dark * 0.4);
                // Polar caps
                float latitude = abs(vUv.y - 0.5) * 2.0;
                float ice = smoothstep(0.88, 0.95, latitude);
                color = mix(color, vec3(1.0, 0.98, 0.95), ice);
            }
            else if(uPlanetType == 4) {
                // Jupiter - bands and storms
                float bands = sin(vUv.y * 30.0 + fbm(pos, 3) * 2.0) * 0.5 + 0.5;
                color = mix(uColor1, uColor2, bands);
                float storms = fbm(pos * 3.0 + time * 0.2, 4);
                color = mix(color, uColor3, storms * 0.3);
                // Great Red Spot
                vec2 spotCenter = vec2(0.65, 0.55);
                float spotDist = length((vUv - spotCenter) * vec2(1.5, 2.5));
                float spot = 1.0 - smoothstep(0.05, 0.12, spotDist);
                color = mix(color, vec3(0.8, 0.3, 0.2), spot);
            }
            else if(uPlanetType == 5) {
                // Saturn - subtle bands
                float bands = sin(vUv.y * 20.0 + fbm(pos, 2) * 1.5) * 0.5 + 0.5;
                color = mix(uColor1, uColor2, bands);
                float detail = fbm(pos * 4.0, 3);
                color = mix(color, uColor3, detail * 0.2);
            }
            else if(uPlanetType == 6) {
                // Uranus - smooth cyan with subtle features
                float features = fbm(pos * 2.0, 4);
                color = mix(uColor1, uColor2, features * 0.3 + 0.5);
            }
            else if(uPlanetType == 7) {
                // Neptune - deep blue with storms
                float storms = fbm(pos * 3.0 + time * 0.1, 5);
                color = mix(uColor1, uColor2, storms * 0.4 + 0.5);
                float clouds = fbm(pos * 5.0 - time * 0.2, 3);
                color = mix(color, uColor3, clouds * 0.25);
            }
            else {
                color = uColor1;
            }
            
            // Apply lighting
            color *= light;
            
            // Atmospheric rim
            if(uAtmosphere > 0.0) {
                float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 3.0);
                vec3 atmoColor = uColor2 * 1.5;
                color = mix(color, atmoColor, fresnel * uAtmosphere * 0.5);
            }
            
            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="main.js"></script>
</body>
</html>
